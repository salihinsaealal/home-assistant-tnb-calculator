compare_with_bill:
  name: Compare with Actual Bill
  description: Compare calculated costs with your actual TNB bill to verify accuracy
  fields:
    actual_bill:
      name: Actual Bill Amount
      description: Your actual TNB bill amount in RM
      required: true
      example: 156.50
      selector:
        number:
          min: 0
          max: 10000
          step: 0.01
          mode: box
          unit_of_measurement: "MYR"
    month:
      name: Month
      description: Month of the bill (1-12). Leave empty for current month.
      required: false
      example: 10
      selector:
        number:
          min: 1
          max: 12
          step: 1
          mode: box
    year:
      name: Year
      description: Year of the bill. Leave empty for current year.
      required: false
      example: 2025
      selector:
        number:
          min: 2020
          max: 2030
          step: 1
          mode: box

reset_storage:
  name: Reset Stored Data
  description: Clear cached energy totals, historical months, and cached holidays. Use with caution.
  fields:
    confirm:
      name: Type "RESET" to confirm
      description: Safety confirmation to prevent accidental resets.
      required: true
      example: RESET
      selector:
        text:

set_import_energy_values:
  name: Set Import Energy Values
  description: |
    Set exact import energy values for calibration.
    
    ‚è±Ô∏è Note: Values update immediately in storage but sensor display has a delay. For instant sensor refresh, reload the integration.
  fields:
    import_total:
      name: Import Total (kWh)
      description: "üìä Target import energy value in kWh. Used in: ALL modes"
      required: true
      example: 1500.5
      selector:
        number:
          min: 0
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"
    distribution:
      name: Distribution Method
      description: "üîÄ How to distribute between peak and off-peak periods."
      required: false
      default: "auto"
      example: "auto"
      selector:
        select:
          options:
            - label: "Auto (detect based on current time)"
              value: "auto"
            - label: "Peak Only (change affects peak only)"
              value: "peak_only"
            - label: "Off-Peak Only (change affects off-peak only)"
              value: "offpeak_only"
            - label: "Proportional (split by current peak/off-peak ratio)"
              value: "proportional"
            - label: "Manual (specify exact peak/off-peak)"
              value: "manual"
    import_peak:
      name: "‚ö° Import Peak (kWh)"
      description: "‚ö†Ô∏è ONLY for 'manual' mode: Exact peak import value. Peak + Off-peak must equal Import Total."
      required: false
      example: 650.0
      selector:
        number:
          min: 0
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"
    import_offpeak:
      name: "üåô Import Off-Peak (kWh)"
      description: "‚ö†Ô∏è ONLY for 'manual' mode: Exact off-peak import value. Peak + Off-peak must equal Import Total."
      required: false
      example: 850.5
      selector:
        number:
          min: 0
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"

set_export_energy_values:
  name: Set Export Energy Values
  description: |
    Set exact export energy value for calibration.
    
    ‚è±Ô∏è Sensor values refresh automatically within ~5 minutes (coordinator interval). Use **Home Assistant ‚Üí Developer Tools ‚Üí Services ‚Üí `homeassistant.update_entity`** or reload the integration for instant updates.
    
    Example: export_total: 250.5
  fields:
    export_total:
      name: Export Total (kWh)
      description: Target export energy value in kWh
      required: true
      example: 250.0
      selector:
        number:
          min: 0
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"

adjust_import_energy_values:
  name: Adjust Import Energy Values
  description: |
    Apply offset adjustments (add/subtract) to import energy values.
    
    ‚è±Ô∏è Note: Values update immediately in storage but sensor display has a delay. For instant sensor refresh, reload the integration.
  fields:
    import_adjustment:
      name: Import Adjustment (kWh)
      description: "üìä Amount to add (+) or subtract (-) from import total. Used in: ALL modes"
      required: true
      example: 20.5
      selector:
        number:
          min: -100000
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"
    distribution:
      name: Distribution Method
      description: "üîÄ How to distribute the adjustment between peak and off-peak periods."
      required: false
      default: "auto"
      example: "auto"
      selector:
        select:
          options:
            - label: "Auto (detect based on current time)"
              value: "auto"
            - label: "Peak Only (adjustment affects peak only)"
              value: "peak_only"
            - label: "Off-Peak Only (adjustment affects off-peak only)"
              value: "offpeak_only"
            - label: "Proportional (split by current peak/off-peak ratio)"
              value: "proportional"
            - label: "Manual (specify exact peak/off-peak adjustments)"
              value: "manual"
    peak_adjustment:
      name: "‚ö° Peak Adjustment (kWh)"
      description: "‚ö†Ô∏è ONLY for 'manual' mode: Exact peak adjustment. Peak + Off-peak must equal Import Adjustment."
      required: false
      example: 10.0
      selector:
        number:
          min: -100000
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"
    offpeak_adjustment:
      name: "üåô Off-Peak Adjustment (kWh)"
      description: "‚ö†Ô∏è ONLY for 'manual' mode: Exact off-peak adjustment. Peak + Off-peak must equal Import Adjustment."
      required: false
      example: 10.5
      selector:
        number:
          min: -100000
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"

adjust_export_energy_values:
  name: Adjust Export Energy Values
  description: |
    Apply offset adjustment (add/subtract) to export energy value.
    
    ‚è±Ô∏è Sensor values refresh automatically within ~5 minutes (coordinator interval). Use **Home Assistant ‚Üí Developer Tools ‚Üí Services ‚Üí `homeassistant.update_entity`** or reload the integration for instant updates.
    
    Example: export_adjustment: -5.0
  fields:
    export_adjustment:
      name: Export Adjustment (kWh)
      description: Amount to add (+) or subtract (-) from export total
      required: true
      example: -5.0
      selector:
        number:
          min: -100000
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"

set_afa_rate:
  name: Set AFA Rate (Manual)
  description: |
    Manually set the AFA (Automatic Fuel Adjustment) rate.
    
    üîÑ Use this when you want to manually override the AFA rate without calling an API.
    
    üí° The AFA rate is applied to usage above 600 kWh.
    
    üìù Note: Use `fetch_afa_rate` or `fetch_all_rates` to get rates from API instead.
    
    Example: afa_rate: 0.0891
  fields:
    afa_rate:
      name: AFA Rate (MYR/kWh)
      description: |
        AFA (Automatic Fuel Adjustment) rate in MYR per kWh.
        Applied when monthly usage exceeds 600 kWh.
        
        Enter a positive value (e.g., 0.0891 for Nov 2025).
        The integration handles sign internally.
      required: true
      example: "0.0891"
      selector:
        number:
          min: 0
          max: 1
          step: 0.0001
          mode: box
          unit_of_measurement: "MYR/kWh"

reset_tariff_rates:
  name: Reset All Tariff Rates
  description: |
    Reset ALL tariff rate overrides back to hardcoded default values.
    
    This will clear any custom or API-fetched rates and revert to defaults.
    
    **Default values after reset:**
    
    üìä **AFA (Automatic Fuel Adjustment)**
    - AFA Rate: 0.0145 MYR/kWh
    - AFA Threshold: 600 kWh
    
    ‚ö° **Generation Rates (ToU)**
    - Peak Tier 1: 0.2852 MYR/kWh (<1500 kWh)
    - Off-Peak Tier 1: 0.2443 MYR/kWh (<1500 kWh)
    - Peak Tier 2: 0.3852 MYR/kWh (‚â•1500 kWh)
    - Off-Peak Tier 2: 0.3443 MYR/kWh (‚â•1500 kWh)
    
    üîå **Generation Rate (Non-ToU)**
    - Import: 0.2703 MYR/kWh
    
    üèóÔ∏è **Shared Rates**
    - Capacity: 0.0455 MYR/kWh
    - Network: 0.1285 MYR/kWh
    - Retailing: 10.00 MYR
    
    üéÅ **ICT (Insentif Cekap Tenaga)**
    - 16 tiers from -0.25 to -0.005 MYR/kWh
  fields:
    confirm:
      name: Type "RESET" to confirm
      description: Safety confirmation to prevent accidental resets.
      required: true
      example: RESET
      selector:
        text:

fetch_afa_rate:
  name: Fetch AFA Rate from API
  description: |
    Fetch only the AFA rate from the `/afa/simple` API endpoint.
    
    üì° Use this for lightweight AFA-only updates.
    
    Expected API response format:
    ```json
    {
        "afa_rate": 0.0891,
        "afa_rate_raw": -0.0891,
        "effective_date": "2025-11-01",
        "last_scraped": "2025-11-29T10:00:00"
    }
    ```
    
    üí° For all tariffs (generation, capacity, network, ICT, etc.), use `fetch_all_rates` instead.
  fields:
    api_url:
      name: API URL (optional)
      description: |
        Override URL to fetch AFA from.
        Should point to `/afa/simple` endpoint.
        Leave empty to use the configured default URL.
      required: false
      example: "http://192.168.1.100:8001/afa/simple"
      selector:
        text:

fetch_all_rates:
  name: Fetch All Tariff Rates from API
  description: |
    Fetch complete tariff data from the `/complete` API endpoint.
    
    üì° This fetches ALL tariff rates in one call:
    - AFA rates (current + all periods)
    - Generation rates (ToU peak/off-peak, non-ToU)
    - Capacity rate
    - Network rate
    - Retailing charge
    - ICT tiers (16 levels)
    
    Expected API response format (from `/complete`):
    ```json
    {
        "last_scraped": "2025-11-29T11:31:36",
        "current_rate": {
            "afa_rate": 0.0891,
            "effective_date": "2025-11-01"
        },
        "tariffs": {
            "non_tou": {
                "tier1": { "generation": 0.2703 },
                "tier2": { "generation": 0.3703 }
            },
            "tou": {
                "tier1": { "generation_peak": 0.2852, "generation_offpeak": 0.2443 },
                "tier2": { "generation_peak": 0.3852, "generation_offpeak": 0.3443 }
            },
            "shared": {
                "capacity": 0.0455,
                "network": 0.1285,
                "retailing": 10.0
            },
            "ict_tiers": [...]
        }
    }
    ```
    
    üí° Use `reset_tariff_rates` to revert to hardcoded defaults.
  fields:
    api_url:
      name: API URL (optional)
      description: |
        Override URL to fetch all rates from.
        Should point to `/complete` endpoint.
        Leave empty to use the configured default URL with `/complete` path.
      required: false
      example: "http://192.168.1.100:8001/complete"
      selector:
        text:
