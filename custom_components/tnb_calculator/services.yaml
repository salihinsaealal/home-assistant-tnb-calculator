compare_with_bill:
  name: Compare with Actual Bill
  description: Compare calculated costs with your actual TNB bill to verify accuracy
  fields:
    actual_bill:
      name: Actual Bill Amount
      description: Your actual TNB bill amount in RM
      required: true
      example: 156.50
      selector:
        number:
          min: 0
          max: 10000
          step: 0.01
          mode: box
          unit_of_measurement: "RM"
    month:
      name: Month
      description: Month of the bill (1-12). Leave empty for current month.
      required: false
      example: 10
      selector:
        number:
          min: 1
          max: 12
          step: 1
          mode: box
    year:
      name: Year
      description: Year of the bill. Leave empty for current year.
      required: false
      example: 2025
      selector:
        number:
          min: 2020
          max: 2030
          step: 1
          mode: box

reset_storage:
  name: Reset Stored Data
  description: Clear cached energy totals, historical months, and cached holidays. Use with caution.
  fields:
    confirm:
      name: Type "RESET" to confirm
      description: Safety confirmation to prevent accidental resets.
      required: true
      example: RESET
      selector:
        text:

set_import_energy_values:
  name: Set Import Energy Values
  description: |
    Set exact import energy values for calibration.
    
    ‚è±Ô∏è Note: Values update immediately in storage but sensor display has a delay. For instant sensor refresh, reload the integration.
  fields:
    import_total:
      name: Import Total (kWh)
      description: "üìä Target import energy value in kWh. Used in: ALL modes"
      required: true
      example: 1500.5
      selector:
        number:
          min: 0
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"
    distribution:
      name: Distribution Method
      description: "üîÄ How to distribute between peak and off-peak periods."
      required: false
      default: "auto"
      example: "auto"
      selector:
        select:
          options:
            - label: "Auto (detect based on current time)"
              value: "auto"
            - label: "Peak Only (change affects peak only)"
              value: "peak_only"
            - label: "Off-Peak Only (change affects off-peak only)"
              value: "offpeak_only"
            - label: "Proportional (split by current peak/off-peak ratio)"
              value: "proportional"
            - label: "Manual (specify exact peak/off-peak)"
              value: "manual"
    import_peak:
      name: "‚ö° Import Peak (kWh)"
      description: "‚ö†Ô∏è ONLY for 'manual' mode: Exact peak import value. Peak + Off-peak must equal Import Total."
      required: false
      example: 650.0
      selector:
        number:
          min: 0
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"
    import_offpeak:
      name: "üåô Import Off-Peak (kWh)"
      description: "‚ö†Ô∏è ONLY for 'manual' mode: Exact off-peak import value. Peak + Off-peak must equal Import Total."
      required: false
      example: 850.5
      selector:
        number:
          min: 0
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"

set_export_energy_values:
  name: Set Export Energy Values
  description: |
    Set exact export energy value for calibration.
    
    ‚è±Ô∏è Sensor values refresh automatically within ~5 minutes (coordinator interval). Use **Home Assistant ‚Üí Developer Tools ‚Üí Services ‚Üí `homeassistant.update_entity`** or reload the integration for instant updates.
    
    Example: export_total: 250.5
  fields:
    export_total:
      name: Export Total (kWh)
      description: Target export energy value in kWh
      required: true
      example: 250.0
      selector:
        number:
          min: 0
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"

adjust_import_energy_values:
  name: Adjust Import Energy Values
  description: |
    Apply offset adjustments (add/subtract) to import energy values.
    
    ‚è±Ô∏è Note: Values update immediately in storage but sensor display has a delay. For instant sensor refresh, reload the integration.
  fields:
    import_adjustment:
      name: Import Adjustment (kWh)
      description: "üìä Amount to add (+) or subtract (-) from import total. Used in: ALL modes"
      required: true
      example: 20.5
      selector:
        number:
          min: -100000
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"
    distribution:
      name: Distribution Method
      description: "üîÄ How to distribute the adjustment between peak and off-peak periods."
      required: false
      default: "auto"
      example: "auto"
      selector:
        select:
          options:
            - label: "Auto (detect based on current time)"
              value: "auto"
            - label: "Peak Only (adjustment affects peak only)"
              value: "peak_only"
            - label: "Off-Peak Only (adjustment affects off-peak only)"
              value: "offpeak_only"
            - label: "Proportional (split by current peak/off-peak ratio)"
              value: "proportional"
            - label: "Manual (specify exact peak/off-peak adjustments)"
              value: "manual"
    peak_adjustment:
      name: "‚ö° Peak Adjustment (kWh)"
      description: "‚ö†Ô∏è ONLY for 'manual' mode: Exact peak adjustment. Peak + Off-peak must equal Import Adjustment."
      required: false
      example: 10.0
      selector:
        number:
          min: -100000
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"
    offpeak_adjustment:
      name: "üåô Off-Peak Adjustment (kWh)"
      description: "‚ö†Ô∏è ONLY for 'manual' mode: Exact off-peak adjustment. Peak + Off-peak must equal Import Adjustment."
      required: false
      example: 10.5
      selector:
        number:
          min: -100000
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"

adjust_export_energy_values:
  name: Adjust Export Energy Values
  description: |
    Apply offset adjustment (add/subtract) to export energy value.
    
    ‚è±Ô∏è Sensor values refresh automatically within ~5 minutes (coordinator interval). Use **Home Assistant ‚Üí Developer Tools ‚Üí Services ‚Üí `homeassistant.update_entity`** or reload the integration for instant updates.
    
    Example: export_adjustment: -5.0
  fields:
    export_adjustment:
      name: Export Adjustment (kWh)
      description: Amount to add (+) or subtract (-) from export total
      required: true
      example: -5.0
      selector:
        number:
          min: -100000
          max: 100000
          step: 0.1
          mode: box
          unit_of_measurement: "kWh"

set_tariff_rates:
  name: Set Tariff Rates
  description: |
    Override tariff rates used in ToU cost calculations.
    
    üîÑ TNB updates rates periodically. When new rates are announced, use this service to update your integration without waiting for a code update.
    
    üí° The AFA rate is applied to usage above 600 kWh. The default rate is 0.0145 RM/kWh.
    
    Example: afa_rate: 0.0160
  fields:
    afa_rate:
      name: AFA Rate (RM/kWh)
      description: |
        Additional Facility Charge rate in RM per kWh.
        Applied when monthly usage exceeds 600 kWh.
        Default: 0.0145 RM/kWh
        
        Enter a value between 0 and 1 (e.g., 0.0145)
      required: true
      example: "0.0145"
      selector:
        text:

reset_tariff_rates:
  name: Reset Tariff Rates
  description: |
    Reset all tariff rate overrides back to default values.
    
    This will clear any custom AFA rate and revert to the hardcoded defaults.
    
    Default values:
    - AFA Rate: 0.0145 RM/kWh
    - AFA Threshold: 600 kWh
    - Retailing Charge: RM 10.00
  fields:
    confirm:
      name: Type "RESET" to confirm
      description: Safety confirmation to prevent accidental resets.
      required: true
      example: RESET
      selector:
        text:

fetch_tariff_rates:
  name: Fetch Tariff Rates from API
  description: |
    Fetch tariff rates from a remote API endpoint.
    
    üì° Use this to pull the latest AFA rate from a configured API.
    
    Expected API response format:
    ```json
    {
      "afa_rate": 0.0160,
      "effective_date": "2025-01-01"
    }
    ```
    
    üí° The API URL can be configured in integration options or provided per-call.
  fields:
    api_url:
      name: API URL (optional)
      description: |
        Override URL to fetch from.
        Leave empty to use the configured default URL.
      required: false
      example: "https://api.example.com/tnb/tariffs"
      selector:
        text:
