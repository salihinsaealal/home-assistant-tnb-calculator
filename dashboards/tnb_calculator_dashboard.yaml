title: TNB Calculator
icon: mdi:lightning-bolt-circle
badges: []
cards: []
type: sections
sections:
  - type: grid
    cards:
      - type: heading
        heading_style: title
        heading: Main Cost
      - type: entities
        title: üí∞ Monthly Costs
        show_header_toggle: false
        entities:
          - entity: sensor.tnb_calculator_total_cost_tou
            name: ToU Cost
            icon: mdi:lightning-bolt
          - entity: sensor.tnb_calculator_total_cost_non_tou
            name: Flat Cost
            icon: mdi:cash-multiple
          - entity: sensor.tnb_calculator_predicted_monthly_cost
            name: Forecast
            icon: mdi:chart-line-variant
          - type: divider
          - entity: sensor.tnb_calculator_usage_tier
            name: Current Tier
            icon: mdi:stairs
      - type: entities
        title: üéØ AFA Optimization
        show_header_toggle: false
        entities:
          - entity: sensor.tnb_calculator_ideal_monthly_import
            name: Ideal Monthly Import
            icon: mdi:target
          - entity: sensor.tnb_calculator_savings_at_ideal_import
            name: Savings at Ideal
            icon: mdi:piggy-bank
          - entity: sensor.tnb_calculator_afa_optimization_savings
            name: AFA 600kWh Savings
            icon: mdi:cash-refund
          - entity: sensor.tnb_calculator_afa_explanation
            name: AFA Zone
            icon: mdi:information-outline
            secondary_info: none
          - type: divider
          - entity: sensor.tnb_calculator_afa_weird_zone
            name: Weird Zone Alert
            icon: mdi:alert-circle
          - entity: sensor.tnb_calculator_afa_value_zone
            name: Value Zone Alert
            icon: mdi:hand-coin
  - type: grid
    cards:
      - type: heading
        heading: Details
        heading_style: title
      - type: entities
        title: ‚ö° Energy Usage
        show_header_toggle: false
        entities:
          - entity: sensor.tnb_calculator_import_energy
            name: Monthly Import
            icon: mdi:transmission-tower-import
          - entity: sensor.tnb_calculator_export_energy
            name: Monthly Export
            icon: mdi:transmission-tower-export
          - entity: sensor.tnb_calculator_net_energy
            name: Net Energy
            icon: mdi:swap-horizontal
          - type: divider
          - entity: sensor.tnb_calculator_today_import
            name: Today Import
            icon: mdi:calendar-today
          - entity: sensor.tnb_calculator_today_export
            name: Today Export
            icon: mdi:solar-power
      - type: entities
        title: üìÖ Period & Status
        show_header_toggle: false
        entities:
          - entity: sensor.tnb_calculator_period_status
            name: Current Period
            icon: mdi:clock-outline
          - entity: sensor.tnb_calculator_day_status
            name: Day Type
            icon: mdi:calendar-week
          - entity: sensor.tnb_calculator_holiday_today
            name: Holiday Today
            icon: mdi:party-popper
          - entity: sensor.tnb_calculator_high_usage_alert
            name: High Usage Alert
            icon: mdi:alert-circle
      - type: entities
        title: üõ†Ô∏è Diagnostics
        show_header_toggle: false
        entities:
          - entity: sensor.tnb_calculator_cached_holidays
            name: Cached Holidays
            icon: mdi:calendar-star
          - entity: sensor.tnb_calculator_validation_status
            name: Validation Status
            icon: mdi:shield-check
          - entity: sensor.tnb_calculator_storage_health
            name: Storage Health
            icon: mdi:database-check
          - entity: sensor.tnb_calculator_integration_uptime
            name: Integration Uptime
            icon: mdi:clock-check
  - type: grid
    cards:
      - type: heading
        heading: Visualization
        heading_style: title
      - type: custom:apexcharts-card
        header:
          show: true
          title: üìä Monthly Cost Comparison (ToU vs Flat)
          show_states: true
        graph_span: 30d
        apex_config:
          chart:
            height: 300
            background: transparent
          theme:
            mode: dark
          stroke:
            width: 3
            curve: smooth
          fill:
            type: gradient
            gradient:
              shadeIntensity: 0.4
              opacityFrom: 0.6
              opacityTo: 0.1
          legend:
            show: true
            position: top
          grid:
            borderColor: "#444"
        series:
          - entity: sensor.tnb_calculator_total_cost_tou
            name: ToU Cost
            type: area
            color: "#FF9800"
            stroke_width: 3
          - entity: sensor.tnb_calculator_total_cost_non_tou
            name: Flat Cost
            type: area
            color: "#4CAF50"
            stroke_width: 3
          - entity: sensor.tnb_calculator_predicted_monthly_cost
            name: Forecast
            type: line
            color: "#9C27B0"
            stroke_width: 2
            curve: stepline
      - type: custom:apexcharts-card
        header:
          show: true
          title: ‚ö° Daily Energy Flow (Import vs Export)
          show_states: true
        graph_span: 7d
        span:
          end: day
        yaxis:
          - id: energy
            decimals: 1
            apex_config:
              title:
                text: kWh
        apex_config:
          chart:
            height: 300
            background: transparent
          theme:
            mode: dark
          plotOptions:
            bar:
              columnWidth: 70%
          stroke:
            width: 2
          legend:
            show: true
            position: top
          grid:
            borderColor: "#444"
        series:
          - entity: sensor.tnb_calculator_import_energy
            name: Import
            type: column
            group_by:
              func: diff
              duration: 1d
            yaxis_id: energy
            color: "#F44336"
          - entity: sensor.tnb_calculator_export_energy
            name: Export
            type: column
            group_by:
              func: diff
              duration: 1d
            yaxis_id: energy
            color: "#4CAF50"
header:
  card:
    type: markdown
    content: |-
      # Hello {{ user }}
      This is your Energy Monitoring Board ‚ú®
